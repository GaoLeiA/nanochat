<mxfile host="Electron" agent="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) draw.io/29.3.6 Chrome/140.0.7339.249 Electron/38.8.0 Safari/537.36" version="29.3.6">
  <diagram name="LLM训练流程图" id="training_flowchart">
    <mxGraphModel dx="12754" dy="7314" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1400" pageHeight="1600" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="title" parent="1" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;fontSize=22;fontStyle=1;fontColor=#333333;" value="NanoChat 完整训练流程图" vertex="1">
          <mxGeometry height="40" width="300" x="450" y="20" as="geometry" />
        </mxCell>
        <mxCell id="phase1" parent="1" style="swimlane;startSize=30;fillColor=#f8cecc;strokeColor=#b85450;fontStyle=1;fontSize=14;" value="阶段1: 分词器训练" vertex="1">
          <mxGeometry height="280" width="300" x="40" y="80" as="geometry" />
        </mxCell>
        <mxCell id="tok_start" parent="phase1" style="ellipse;fillColor=#d5e8d4;strokeColor=#82b366;" value="开始" vertex="1">
          <mxGeometry height="40" width="70" x="115" y="40" as="geometry" />
        </mxCell>
        <mxCell id="tok_load" parent="phase1" style="rounded=1;fillColor=#fff2cc;strokeColor=#d6b656;" value="加载训练语料" vertex="1">
          <mxGeometry height="40" width="120" x="90" y="100" as="geometry" />
        </mxCell>
        <mxCell id="tok_train" parent="phase1" style="rounded=1;fillColor=#fff2cc;strokeColor=#d6b656;" value="训练BPE分词器&#xa;(RustBPE)" vertex="1">
          <mxGeometry height="40" width="120" x="90" y="160" as="geometry" />
        </mxCell>
        <mxCell id="tok_save" parent="phase1" style="rounded=1;fillColor=#fff2cc;strokeColor=#d6b656;" value="保存分词器&#xa;(vocab, merges)" vertex="1">
          <mxGeometry height="40" width="120" x="90" y="220" as="geometry" />
        </mxCell>
        <mxCell id="e1" edge="1" parent="phase1" source="tok_start" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;" target="tok_load" />
        <mxCell id="e2" edge="1" parent="phase1" source="tok_load" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;" target="tok_train" />
        <mxCell id="e3" edge="1" parent="phase1" source="tok_train" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;" target="tok_save" />
        <mxCell id="phase2" parent="1" style="swimlane;startSize=30;fillColor=#fff2cc;strokeColor=#d6b656;fontStyle=1;fontSize=14;" value="阶段2: 基座模型预训练 (Base Training)" vertex="1">
          <mxGeometry height="520" width="340" x="360" y="80" as="geometry" />
        </mxCell>
        <mxCell id="pt_init" parent="phase2" style="ellipse;fillColor=#d5e8d4;strokeColor=#82b366;" value="初始化" vertex="1">
          <mxGeometry height="40" width="70" x="135" y="40" as="geometry" />
        </mxCell>
        <mxCell id="pt_tok" parent="phase2" style="rounded=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" value="加载分词器" vertex="1">
          <mxGeometry height="35" width="120" x="105" y="100" as="geometry" />
        </mxCell>
        <mxCell id="pt_model" parent="phase2" style="rounded=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" value="创建GPT模型&#xa;(meta device)" vertex="1">
          <mxGeometry height="40" width="120" x="105" y="150" as="geometry" />
        </mxCell>
        <mxCell id="pt_weights" parent="phase2" style="rounded=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" value="初始化权重&#xa;init_weights()" vertex="1">
          <mxGeometry height="40" width="120" x="105" y="205" as="geometry" />
        </mxCell>
        <mxCell id="pt_compile" parent="phase2" style="rounded=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" value="torch.compile()" vertex="1">
          <mxGeometry height="35" width="120" x="105" y="260" as="geometry" />
        </mxCell>
        <mxCell id="pt_optim" parent="phase2" style="rounded=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" value="创建MuonAdamW&#xa;优化器" vertex="1">
          <mxGeometry height="40" width="120" x="105" y="310" as="geometry" />
        </mxCell>
        <mxCell id="pt_loop" parent="phase2" style="rhombus;fillColor=#e1d5e7;strokeColor=#9673a6;" value="训练循环" vertex="1">
          <mxGeometry height="50" width="130" x="100" y="365" as="geometry" />
        </mxCell>
        <mxCell id="pt_fwd" parent="phase2" style="rounded=1;fillColor=#ffe6cc;strokeColor=#d79b00;" value="forward + backward&#xa;+ optimizer.step()" vertex="1">
          <mxGeometry height="50" width="95" x="235" y="375" as="geometry" />
        </mxCell>
        <mxCell id="pt_eval" parent="phase2" style="rounded=1;fillColor=#f5f5f5;strokeColor=#666666;" value="评估CORE/BPB" vertex="1">
          <mxGeometry height="40" width="85" x="10" y="375" as="geometry" />
        </mxCell>
        <mxCell id="pt_save" parent="phase2" style="rounded=1;fillColor=#d5e8d4;strokeColor=#82b366;" value="保存checkpoint" vertex="1">
          <mxGeometry height="40" width="110" x="110" y="465" as="geometry" />
        </mxCell>
        <mxCell id="e4" edge="1" parent="phase2" source="pt_init" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;" target="pt_tok" />
        <mxCell id="e5" edge="1" parent="phase2" source="pt_tok" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;" target="pt_model" />
        <mxCell id="e6" edge="1" parent="phase2" source="pt_model" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;" target="pt_weights" />
        <mxCell id="e7" edge="1" parent="phase2" source="pt_weights" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;" target="pt_compile" />
        <mxCell id="e8" edge="1" parent="phase2" source="pt_compile" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;" target="pt_optim" />
        <mxCell id="e9" edge="1" parent="phase2" source="pt_optim" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;" target="pt_loop" />
        <mxCell id="e10" edge="1" parent="phase2" source="pt_loop" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;exitX=1;exitY=0.5;" target="pt_fwd" value="继续" />
        <mxCell id="e10b" edge="1" parent="phase2" source="pt_fwd" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;entryX=1;entryY=0;" target="pt_loop">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="283" y="365" />
              <mxPoint x="180" y="365" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="e11" edge="1" parent="phase2" source="pt_loop" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;dashed=1;exitX=0;exitY=0.5;" target="pt_eval" />
        <mxCell id="e12" edge="1" parent="phase2" source="pt_loop" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;exitX=0.5;exitY=1;" target="pt_save" value="完成" />
        <mxCell id="phase3" parent="1" style="swimlane;startSize=30;fillColor=#d5e8d4;strokeColor=#82b366;fontStyle=1;fontSize=14;" value="阶段3: SFT微调" vertex="1">
          <mxGeometry height="400" width="300" x="720" y="80" as="geometry" />
        </mxCell>
        <mxCell id="sft_start" parent="phase3" style="ellipse;fillColor=#dae8fc;strokeColor=#6c8ebf;" value="加载Base模型" vertex="1">
          <mxGeometry height="40" width="110" x="90" y="45" as="geometry" />
        </mxCell>
        <mxCell id="sft_data" parent="phase3" style="rounded=1;fillColor=#fff2cc;strokeColor=#d6b656;" value="创建TaskMixture&#xa;(SmolTalk+MMLU&#xa;+GSM8K+...)" vertex="1">
          <mxGeometry height="55" width="130" x="85" y="105" as="geometry" />
        </mxCell>
        <mxCell id="sft_loader" parent="phase3" style="rounded=1;fillColor=#fff2cc;strokeColor=#d6b656;" value="SFT DataLoader&#xa;(BOS对齐+BestFit)" vertex="1">
          <mxGeometry height="45" width="130" x="85" y="180" as="geometry" />
        </mxCell>
        <mxCell id="sft_loop" parent="phase3" style="rhombus;fillColor=#e1d5e7;strokeColor=#9673a6;" value="SFT训练循环&#xa;(带mask)" vertex="1">
          <mxGeometry height="55" width="130" x="85" y="245" as="geometry" />
        </mxCell>
        <mxCell id="sft_save" parent="phase3" style="rounded=1;fillColor=#d5e8d4;strokeColor=#82b366;" value="保存SFT模型" vertex="1">
          <mxGeometry height="40" width="110" x="95" y="330" as="geometry" />
        </mxCell>
        <mxCell id="e13" edge="1" parent="phase3" source="sft_start" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;" target="sft_data" />
        <mxCell id="e14" edge="1" parent="phase3" source="sft_data" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;" target="sft_loader" />
        <mxCell id="e15" edge="1" parent="phase3" source="sft_loader" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;" target="sft_loop" />
        <mxCell id="e16" edge="1" parent="phase3" source="sft_loop" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;" target="sft_save" />
        <mxCell id="phase4" parent="1" style="swimlane;startSize=30;fillColor=#ffe6cc;strokeColor=#d79b00;fontStyle=1;fontSize=14;" value="阶段4: RL强化学习 (可选)" vertex="1">
          <mxGeometry height="350" width="300" x="1040" y="80" as="geometry" />
        </mxCell>
        <mxCell id="rl_start" parent="phase4" style="ellipse;fillColor=#dae8fc;strokeColor=#6c8ebf;" value="加载SFT模型" vertex="1">
          <mxGeometry height="40" width="110" x="90" y="45" as="geometry" />
        </mxCell>
        <mxCell id="rl_task" parent="phase4" style="rounded=1;fillColor=#fff2cc;strokeColor=#d6b656;" value="加载RL任务&#xa;(GSM8K/代码执行)" vertex="1">
          <mxGeometry height="50" width="130" x="85" y="105" as="geometry" />
        </mxCell>
        <mxCell id="rl_gen" parent="phase4" style="rounded=1;fillColor=#e1d5e7;strokeColor=#9673a6;" value="模型生成回答" vertex="1">
          <mxGeometry height="40" width="130" x="85" y="175" as="geometry" />
        </mxCell>
        <mxCell id="rl_reward" parent="phase4" style="rounded=1;fillColor=#f8cecc;strokeColor=#b85450;" value="计算Reward&#xa;(正确性评估)" vertex="1">
          <mxGeometry height="45" width="130" x="85" y="235" as="geometry" />
        </mxCell>
        <mxCell id="rl_update" parent="phase4" style="rounded=1;fillColor=#d5e8d4;strokeColor=#82b366;" value="策略梯度更新" vertex="1">
          <mxGeometry height="35" width="130" x="85" y="300" as="geometry" />
        </mxCell>
        <mxCell id="e17" edge="1" parent="phase4" source="rl_start" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;" target="rl_task" />
        <mxCell id="e18" edge="1" parent="phase4" source="rl_task" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;" target="rl_gen" />
        <mxCell id="e19" edge="1" parent="phase4" source="rl_gen" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;" target="rl_reward" />
        <mxCell id="e20" edge="1" parent="phase4" source="rl_reward" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;" target="rl_update" />
        <mxCell id="phase5" parent="1" style="swimlane;startSize=30;fillColor=#e1d5e7;strokeColor=#9673a6;fontStyle=1;fontSize=14;" value="阶段5: 推理服务" vertex="1">
          <mxGeometry height="280" width="600" x="40" y="620" as="geometry" />
        </mxCell>
        <mxCell id="inf_load" parent="phase5" style="ellipse;fillColor=#dae8fc;strokeColor=#6c8ebf;" value="加载模型&#xa;(load_model)" vertex="1">
          <mxGeometry height="50" width="100" x="40" y="50" as="geometry" />
        </mxCell>
        <mxCell id="inf_engine" parent="phase5" style="rounded=1;fillColor=#fff2cc;strokeColor=#d6b656;" value="创建Engine&#xa;(KVCache初始化)" vertex="1">
          <mxGeometry height="50" width="100" x="40" y="120" as="geometry" />
        </mxCell>
        <mxCell id="inf_server" parent="phase5" style="rounded=1;fillColor=#d5e8d4;strokeColor=#82b366;" value="FastAPI服务启动&#xa;(WorkerPool)" vertex="1">
          <mxGeometry height="50" width="100" x="40" y="190" as="geometry" />
        </mxCell>
        <mxCell id="inf_req" parent="phase5" style="ellipse;fillColor=#f8cecc;strokeColor=#b85450;" value="用户请求" vertex="1">
          <mxGeometry height="40" width="80" x="200" y="50" as="geometry" />
        </mxCell>
        <mxCell id="inf_tok_enc" parent="phase5" style="rounded=1;fillColor=#fff2cc;strokeColor=#d6b656;" value="Tokenize输入" vertex="1">
          <mxGeometry height="40" width="100" x="300" y="50" as="geometry" />
        </mxCell>
        <mxCell id="inf_prefill" parent="phase5" style="rounded=1;fillColor=#e1d5e7;strokeColor=#9673a6;" value="Prefill&#xa;(处理prompt)" vertex="1">
          <mxGeometry height="45" width="90" x="420" y="50" as="geometry" />
        </mxCell>
        <mxCell id="inf_decode" parent="phase5" style="rhombus;fillColor=#ffe6cc;strokeColor=#d79b00;" value="Decode Loop&#xa;(自回归生成)" vertex="1">
          <mxGeometry height="55" width="110" x="410" y="115" as="geometry" />
        </mxCell>
        <mxCell id="inf_sample" parent="phase5" style="rounded=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" value="sample_next_token&#xa;(温度采样+top_k)" vertex="1">
          <mxGeometry height="45" width="130" x="240" y="120" as="geometry" />
        </mxCell>
        <mxCell id="inf_tool" parent="phase5" style="rhombus;fillColor=#f5f5f5;strokeColor=#666666;" value="工具调用?&#xa;(Calculator)" vertex="1">
          <mxGeometry height="50" width="110" x="250" y="185" as="geometry" />
        </mxCell>
        <mxCell id="inf_dec" parent="phase5" style="rounded=1;fillColor=#d5e8d4;strokeColor=#82b366;" value="Decode响应" vertex="1">
          <mxGeometry height="40" width="90" x="420" y="195" as="geometry" />
        </mxCell>
        <mxCell id="inf_stream" parent="phase5" style="ellipse;fillColor=#d5e8d4;strokeColor=#82b366;" value="流式返回" vertex="1">
          <mxGeometry height="45" width="70" x="510" y="115" as="geometry" />
        </mxCell>
        <mxCell id="e21" edge="1" parent="phase5" source="inf_load" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;" target="inf_engine" />
        <mxCell id="e22" edge="1" parent="phase5" source="inf_engine" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;" target="inf_server" />
        <mxCell id="e23" edge="1" parent="phase5" source="inf_req" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;" target="inf_tok_enc" />
        <mxCell id="e24" edge="1" parent="phase5" source="inf_tok_enc" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;" target="inf_prefill" />
        <mxCell id="e25" edge="1" parent="phase5" source="inf_prefill" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;" target="inf_decode" />
        <mxCell id="e26" edge="1" parent="phase5" source="inf_decode" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;" target="inf_sample" />
        <mxCell id="e27" edge="1" parent="phase5" source="inf_sample" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;" target="inf_tool" />
        <mxCell id="e28" edge="1" parent="phase5" source="inf_tool" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;entryX=0;entryY=0.5;" target="inf_dec" />
        <mxCell id="e29" edge="1" parent="phase5" source="inf_decode" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;exitX=1;exitY=0.5;" target="inf_stream" />
        <mxCell id="phase_arrow1" edge="1" parent="1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;strokeWidth=3;strokeColor=#82b366;">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="340" y="220" as="sourcePoint" />
            <mxPoint x="360" y="220" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="phase_arrow2" edge="1" parent="1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;strokeWidth=3;strokeColor=#82b366;">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="700" y="280" as="sourcePoint" />
            <mxPoint x="720" y="280" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="phase_arrow3" edge="1" parent="1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;strokeWidth=3;strokeColor=#d79b00;dashed=1;">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1020" y="280" as="sourcePoint" />
            <mxPoint x="1040" y="280" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="phase_arrow4" edge="1" parent="1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;strokeWidth=3;strokeColor=#9673a6;">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="870" y="510" />
              <mxPoint x="340" y="510" />
              <mxPoint x="340" y="620" />
            </Array>
            <mxPoint x="870" y="490" as="sourcePoint" />
            <mxPoint x="870" y="540" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="legend" parent="1" style="swimlane;startSize=25;fillColor=#ffffff;strokeColor=#333333;fontStyle=1;" value="图例" vertex="1">
          <mxGeometry height="100" width="350" x="660" y="620" as="geometry" />
        </mxCell>
        <mxCell id="leg_proc" parent="legend" style="rounded=1;fillColor=#fff2cc;strokeColor=#d6b656;" value="处理步骤" vertex="1">
          <mxGeometry height="25" width="70" x="10" y="35" as="geometry" />
        </mxCell>
        <mxCell id="leg_dec" parent="legend" style="rhombus;fillColor=#e1d5e7;strokeColor=#9673a6;" value="判断" vertex="1">
          <mxGeometry height="35" width="60" x="90" y="30" as="geometry" />
        </mxCell>
        <mxCell id="leg_io" parent="legend" style="ellipse;fillColor=#d5e8d4;strokeColor=#82b366;" value="输入/输出" vertex="1">
          <mxGeometry height="30" width="80" x="160" y="32" as="geometry" />
        </mxCell>
        <mxCell id="leg_opt" edge="1" parent="legend" style="endArrow=block;dashed=1;html=1;strokeWidth=2;" value="可选路径">
          <mxGeometry relative="1" x="-0.2" as="geometry">
            <mxPoint x="250" y="55" as="sourcePoint" />
            <mxPoint x="330" y="55" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Yi4GnmppyirLm2kHB0L9-1" parent="1" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;fontSize=20;fontStyle=1;fontColor=#333333;" value="NanoChat 训练流程序列图" vertex="1">
          <mxGeometry height="30" width="300" x="-4601.5999755859375" y="-3917" as="geometry" />
        </mxCell>
        <mxCell id="Yi4GnmppyirLm2kHB0L9-2" parent="1" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;html=1;container=1;collapsible=0;recursiveResize=0;outlineConnect=0;fillColor=#dae8fc;strokeColor=#6c8ebf;size=40;" value="用户" vertex="1">
          <mxGeometry height="900" width="80" x="-5011.5999755859375" y="-3877" as="geometry" />
        </mxCell>
        <mxCell id="Yi4GnmppyirLm2kHB0L9-3" parent="1" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;html=1;container=1;collapsible=0;recursiveResize=0;outlineConnect=0;fillColor=#fff2cc;strokeColor=#d6b656;size=40;" value="base_train.py" vertex="1">
          <mxGeometry height="900" width="100" x="-4891.5999755859375" y="-3877" as="geometry" />
        </mxCell>
        <mxCell id="Yi4GnmppyirLm2kHB0L9-4" parent="1" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;html=1;container=1;collapsible=0;recursiveResize=0;outlineConnect=0;fillColor=#d5e8d4;strokeColor=#82b366;size=40;" value="GPT模型" vertex="1">
          <mxGeometry height="900" width="80" x="-4751.5999755859375" y="-3877" as="geometry" />
        </mxCell>
        <mxCell id="Yi4GnmppyirLm2kHB0L9-5" parent="1" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;html=1;container=1;collapsible=0;recursiveResize=0;outlineConnect=0;fillColor=#e1d5e7;strokeColor=#9673a6;size=40;" value="DataLoader" vertex="1">
          <mxGeometry height="900" width="80" x="-4631.5999755859375" y="-3877" as="geometry" />
        </mxCell>
        <mxCell id="Yi4GnmppyirLm2kHB0L9-6" parent="1" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;html=1;container=1;collapsible=0;recursiveResize=0;outlineConnect=0;fillColor=#f8cecc;strokeColor=#b85450;size=40;" value="Tokenizer" vertex="1">
          <mxGeometry height="900" width="80" x="-4511.5999755859375" y="-3877" as="geometry" />
        </mxCell>
        <mxCell id="Yi4GnmppyirLm2kHB0L9-7" parent="1" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;html=1;container=1;collapsible=0;recursiveResize=0;outlineConnect=0;fillColor=#ffe6cc;strokeColor=#d79b00;size=40;" value="MuonAdamW" vertex="1">
          <mxGeometry height="900" width="90" x="-4391.5999755859375" y="-3877" as="geometry" />
        </mxCell>
        <mxCell id="Yi4GnmppyirLm2kHB0L9-8" parent="1" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;html=1;container=1;collapsible=0;recursiveResize=0;outlineConnect=0;fillColor=#f5f5f5;strokeColor=#666666;size=40;" value="Checkpoint&#xa;Manager" vertex="1">
          <mxGeometry height="900" width="90" x="-4261.5999755859375" y="-3877" as="geometry" />
        </mxCell>
        <mxCell id="Yi4GnmppyirLm2kHB0L9-9" parent="1" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;html=1;container=1;collapsible=0;recursiveResize=0;outlineConnect=0;fillColor=#dae8fc;strokeColor=#6c8ebf;size=40;" value="Evaluator" vertex="1">
          <mxGeometry height="900" width="80" x="-4131.5999755859375" y="-3877" as="geometry" />
        </mxCell>
        <mxCell id="Yi4GnmppyirLm2kHB0L9-10" edge="1" parent="1" style="endArrow=block;style=html=1;strokeWidth=2;" value="1. torchrun base_train">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="-4971.5999755859375" y="-3817" as="sourcePoint" />
            <mxPoint x="-4841.5999755859375" y="-3817" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Yi4GnmppyirLm2kHB0L9-11" edge="1" parent="1" style="endArrow=block;style=html=1;strokeWidth=2;" value="2. get_tokenizer()">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="-4841.5999755859375" y="-3787" as="sourcePoint" />
            <mxPoint x="-4471.5999755859375" y="-3787" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Yi4GnmppyirLm2kHB0L9-12" edge="1" parent="1" style="endArrow=block;style=html=1;strokeWidth=2;dashed=1;" value="返回 tokenizer">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="-4471.5999755859375" y="-3767" as="sourcePoint" />
            <mxPoint x="-4841.5999755859375" y="-3767" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Yi4GnmppyirLm2kHB0L9-13" edge="1" parent="1" style="endArrow=block;style=html=1;strokeWidth=2;" value="3. 创建GPT(config)">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="-4841.5999755859375" y="-3737" as="sourcePoint" />
            <mxPoint x="-4711.5999755859375" y="-3737" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Yi4GnmppyirLm2kHB0L9-14" edge="1" parent="1" style="endArrow=block;style=html=1;strokeWidth=2;" value="4. init_weights()">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="-4841.5999755859375" y="-3707" as="sourcePoint" />
            <mxPoint x="-4711.5999755859375" y="-3707" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Yi4GnmppyirLm2kHB0L9-15" edge="1" parent="1" style="endArrow=block;style=html=1;strokeWidth=2;" value="5. torch.compile(model)">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="-4841.5999755859375" y="-3677" as="sourcePoint" />
            <mxPoint x="-4711.5999755859375" y="-3677" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Yi4GnmppyirLm2kHB0L9-16" edge="1" parent="1" style="endArrow=block;style=html=1;strokeWidth=2;" value="6. 创建优化器">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="-4841.5999755859375" y="-3647" as="sourcePoint" />
            <mxPoint x="-4346.5999755859375" y="-3647" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Yi4GnmppyirLm2kHB0L9-17" edge="1" parent="1" style="endArrow=block;style=html=1;strokeWidth=2;" value="7. 创建DataLoader">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="-4841.5999755859375" y="-3617" as="sourcePoint" />
            <mxPoint x="-4591.5999755859375" y="-3617" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Yi4GnmppyirLm2kHB0L9-18" parent="1" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;strokeColor=#000000;strokeWidth=2;dashed=1;" value="" vertex="1">
          <mxGeometry height="400" width="960" x="-5001.5999755859375" y="-3577" as="geometry" />
        </mxCell>
        <mxCell id="Yi4GnmppyirLm2kHB0L9-19" parent="1" style="text;html=1;strokeColor=none;fillColor=#e1d5e7;align=left;verticalAlign=middle;fontSize=12;fontStyle=1;" value="loop [训练迭代]" vertex="1">
          <mxGeometry height="25" width="120" x="-4996.5999755859375" y="-3577" as="geometry" />
        </mxCell>
        <mxCell id="Yi4GnmppyirLm2kHB0L9-20" edge="1" parent="1" style="endArrow=block;style=html=1;strokeWidth=2;" value="8. next(train_loader)">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="-4841.5999755859375" y="-3527" as="sourcePoint" />
            <mxPoint x="-4591.5999755859375" y="-3527" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Yi4GnmppyirLm2kHB0L9-21" edge="1" parent="1" style="endArrow=block;style=html=1;strokeWidth=2;" value="encode(batch)">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="-4591.5999755859375" y="-3507" as="sourcePoint" />
            <mxPoint x="-4471.5999755859375" y="-3507" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Yi4GnmppyirLm2kHB0L9-22" edge="1" parent="1" style="endArrow=block;style=html=1;strokeWidth=2;dashed=1;" value="返回 (inputs, targets)">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="-4591.5999755859375" y="-3477" as="sourcePoint" />
            <mxPoint x="-4841.5999755859375" y="-3477" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Yi4GnmppyirLm2kHB0L9-23" edge="1" parent="1" style="endArrow=block;style=html=1;strokeWidth=2;" value="9. forward(x, y) → loss">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="-4841.5999755859375" y="-3437" as="sourcePoint" />
            <mxPoint x="-4711.5999755859375" y="-3437" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Yi4GnmppyirLm2kHB0L9-24" edge="1" parent="1" style="endArrow=block;style=html=1;strokeWidth=2;" value="10. loss.backward()">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="-4841.5999755859375" y="-3397" as="sourcePoint" />
            <mxPoint x="-4711.5999755859375" y="-3397" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Yi4GnmppyirLm2kHB0L9-25" edge="1" parent="1" style="endArrow=block;style=html=1;strokeWidth=2;" value="11. optimizer.step()">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="-4841.5999755859375" y="-3357" as="sourcePoint" />
            <mxPoint x="-4346.5999755859375" y="-3357" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Yi4GnmppyirLm2kHB0L9-26" parent="1" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;strokeColor=#82b366;strokeWidth=2;dashed=1;" value="" vertex="1">
          <mxGeometry height="80" width="850" x="-4901.5999755859375" y="-3317" as="geometry" />
        </mxCell>
        <mxCell id="Yi4GnmppyirLm2kHB0L9-27" parent="1" style="text;html=1;strokeColor=none;fillColor=#d5e8d4;align=left;verticalAlign=middle;fontSize=11;fontStyle=1;" value="opt [每N步评估]" vertex="1">
          <mxGeometry height="20" width="100" x="-4896.5999755859375" y="-3317" as="geometry" />
        </mxCell>
        <mxCell id="Yi4GnmppyirLm2kHB0L9-28" edge="1" parent="1" style="endArrow=block;style=html=1;strokeWidth=2;" value="12. evaluate_core()">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="-4841.5999755859375" y="-3277" as="sourcePoint" />
            <mxPoint x="-4091.5999755859375" y="-3277" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Yi4GnmppyirLm2kHB0L9-29" edge="1" parent="1" style="endArrow=block;style=html=1;strokeWidth=2;dashed=1;" value="返回 CORE score">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="-4091.5999755859375" y="-3257" as="sourcePoint" />
            <mxPoint x="-4841.5999755859375" y="-3257" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Yi4GnmppyirLm2kHB0L9-30" parent="1" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;strokeColor=#d79b00;strokeWidth=2;dashed=1;" value="" vertex="1">
          <mxGeometry height="40" width="720" x="-4901.5999755859375" y="-3227" as="geometry" />
        </mxCell>
        <mxCell id="Yi4GnmppyirLm2kHB0L9-31" parent="1" style="text;html=1;strokeColor=none;fillColor=#ffe6cc;align=left;verticalAlign=middle;fontSize=11;fontStyle=1;" value="opt [每N步保存]" vertex="1">
          <mxGeometry height="20" width="100" x="-4896.5999755859375" y="-3227" as="geometry" />
        </mxCell>
        <mxCell id="Yi4GnmppyirLm2kHB0L9-32" edge="1" parent="1" style="endArrow=block;style=html=1;strokeWidth=2;" value="13. save_checkpoint()">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="-4841.5999755859375" y="-3202" as="sourcePoint" />
            <mxPoint x="-4216.5999755859375" y="-3202" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Yi4GnmppyirLm2kHB0L9-33" edge="1" parent="1" style="endArrow=block;style=html=1;strokeWidth=2;dashed=1;" value="14. 训练完成">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="-4841.5999755859375" y="-3127" as="sourcePoint" />
            <mxPoint x="-4971.5999755859375" y="-3127" as="targetPoint" />
          </mxGeometry>
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
